"use strict";!function(N){function a(t,e,a){var n=new Date,r=n.getDate(),C=n.getMonth(),T=n.getFullYear(),b=r,L=C,F=T,O=a,j=null,A=null,S={posts:[],prev:null,next:null},a="en";t&&"undefined"!=typeof calLanguages&&calLanguages[t]&&(a=t);var W=N.extend({},N.fn.aCalendar.defaults,"undefined"==typeof calLanguages?{}:calLanguages[a],e);function E(){L<11?L++:(L=0,F++),l()}function R(){0<L?L--:(L=11,F--),l()}function J(t){t&&(F=t.getFullYear(),L=t.getMonth(),l())}function U(t){A=t.map(function(t){return t=t.split("-"),new Date(Date.UTC(+t[0],+t[1]-1))})}function Y(){var t=Date.UTC(F,L);if(null!==A&&0!==A.length&&(0!==S.posts.length||!(null===S.prev&&null!==S.next&&S.next.getTime()>t||null===S.next&&null!==S.prev&&S.prev.getTime()<t))){S.posts=[];for(var e=0;e<A.length;e++){var a=A[e].getTime();if(t===a)return S.prev=0===e?null:A[e-1],S.next=e===A.length-1?null:A[e+1],1;if(t<a){S.prev=0===e?null:A[e-1],S.next=A[e];break}S.prev=A[e],S.next=null}}}function $(t,e){var a,n={"LMM+":W.months[t.getMonth()],"MM+":t.getMonth()+1};for(a in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),n)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,"LMM+"===a?n[a]:("00"+n[a]).substr((""+n[a]).length)));return e}function l(){W.single?null!=W.url&&""!=W.url&&(null===j&&N.ajax({url:W.url,async:!1,success:function(t){j=t,U(Object.keys(j))}}),null!==j&&Y()&&(S.posts=j[F+"-"+(L+1)])):(null===A&&N.ajax({url:W.root+"list.json",async:!1,success:function(t){U(t)}}),Y()&&N.ajax({url:W.root+F+"-"+(L+1)+".json",async:!1,success:function(t){S.posts=t}}));var t=new Date(F,L,1).getDay()-W.weekOffset;t<=0&&(t=6- -1*(t+1));var e=new Date(F,L+1,0).getDate(),a=new Date(F,L,0).getDate()-t+1,n=N("<div/>").addClass("cal-head"),r=N("<div/>"),l=N("<div/>"),s=N("<div/>").addClass("cal-title");l.html(W.headArrows.previous),r.html(W.headArrows.next),curDate=new Date(Date.UTC(F,L)),0===S.posts.length?s.html($(curDate,W.titleFormat)):(cTitleLink=N("<a/>").attr("href",$(curDate,W.titleLinkFormat)).attr("title",$(curDate,W.postsMonthTip)).html($(curDate,W.titleFormat)),s.html(cTitleLink)),l.on("click",R),r.on("click",E),n.append(l),n.append(s),n.append(r);for(var o=N("<table/>").addClass("cal"),p=W.weekOffset,u=N("<thead/>"),d=N("<tr/>"),i=0;i<7;i++){6<p&&(p=0);var c=N("<th/>").attr("scope","col").attr("title",W.dayOfWeek[p]);c.html(W.dayOfWeekShort[p]),d.append(c),p++}u.append(d),o.append(u);var f=N("<tfoot/>"),h=N("<tr/>"),l=N("<td/>").attr("colspan",3),s=N("<td/>").html("&nbsp;"),r=N("<td/>").attr("colspan",3);S.prev&&l.html(W.footArrows.previous+W.months[S.prev.getMonth()]).addClass("cal-foot").attr("title",$(S.prev,W.postsMonthTip)),S.next&&r.html(W.months[S.next.getMonth()]+W.footArrows.next).addClass("cal-foot").attr("title",$(S.next,W.postsMonthTip)),l.on("click",function(){J(S.prev)}),r.on("click",function(){J(S.next)}),h.append(l),h.append(s),h.append(r),f.append(h);for(var y=N("<tbody/>"),g=1,v=1,i=0;i<6;i++){for(var m=N("<tr/>"),M=0;M<7;M++){var x=N("<td/>");if(7*i+M<t)x.addClass("cal-gray"),x.html(a++);else if(g<=e){g==b&&C==L&&T==F&&x.addClass("cal-today");for(var D,k={num:0,keys:[]},w=0;w<S.posts.length;w++)new Date(Date.parse(S.posts[w].date)).getDate()==g&&(k.keys[k.num++]=w);0!==k.num?(D=k.keys[0],D=N("<a>").attr("href",S.posts[D].link).attr("title",S.posts[D].title).html(g++),x.append(D)):x.html(g++)}else x.addClass("cal-gray"),x.html(v++);m.append(x)}y.append(m)}o.append(u),o.append(f),o.append(y),N(O).html(n),N(O).append(o)}return"/"!==W.root[0]&&(W.root="/"+W.root),"/"!==W.root[W.root.length-1]&&(W.root+="/"),l()}N.fn.aCalendar=function(t,e){return this.each(function(){return a(t,e,N(this))})},N.fn.aCalendar.defaults={months:["January","February","March","April","May","June","July","August","September","October","November","December"],dayOfWeekShort:["S","M","T","W","T","F","S"],dayOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],postsMonthTip:"Posts published in LMM yyyy",titleFormat:"yyyy LMM",titleLinkFormat:"/archives/yyyy/MM/",headArrows:{previous:'<span class="cal-prev"></span>',next:'<span class="cal-next"></span>'},footArrows:{previous:"« ",next:" »"},weekOffset:0,single:!0,root:"/calendar/",url:"/calendar.json"},N(document).ready(function(){N("#calendar").aCalendar("zh-CN")})}(jQuery);